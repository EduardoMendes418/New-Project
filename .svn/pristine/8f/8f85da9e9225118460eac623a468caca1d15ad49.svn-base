login.controller("farmaciaCtrl", ['$rootScope', '$scope', '$state', '$location', 'loginService', 'Flash','apiService','$http',
function ($rootScope, $scope, $state, $location, loginService, Flash, apiService,$http) {
  var vm = this;

  var url = 'https://www.iptufacil.com.br';
  //var url = 'http://192.168.1.215:4200';

// Combo Cidades
$scope.comboCidade = function(){
  list = [];

  $http({
          method: 'POST',
          url: url + '/ws/goey/rest/public/cidadeAutocomplete',
          data: $.param({                                            
                auth:'3f018bfb43591ccb2ef46f10de832160',
                ramo: 6
              }),

          headers: {'Content-Type': 'application/x-www-form-urlencoded'}
          }).success(function (response){        
         /// $scope.completing = true;
          for(var i=0; i < response.length; i++){

              list[i] = response[i].cidade;

            }     
                  
          }).error(function (response) {
              Flash.create('info', 'Desculpe! Ocorreu um erro.', 'large-text');
       
          });          
}

// Combo Cidade
$scope.comboCidade();

$scope.complete = function () {

        //console.log('aguarde...');

        $( "#tags" ).autocomplete({ source: list,
                  select : function(evt, ui) {

                    $scope.$apply(function(){

                            $scope.c.cidade = ui.item.value;

                              if( ui.item.value != ''){

                              localStorage.setItem('endereco2',JSON.stringify(ui.item.value));
                              //window.location.href = "http://goeyja.com.br/#/lista-estabelecimentos";
                              window.location.href = "http://192.168.1.215:4200/#/lista-estabelecimentosfarma";
                              
                              }
                              
                          });
                  }
        });
};

// Cadastrar Usuario
$scope.cadastrarUsuario = function(){

  $(".btn-primary").hide();

  if (grecaptcha.getResponse() == "") {

    Flash.create('danger', 'Robôs não podem enviar esse formulário!', 'large-text');
    return false;
  }

 if ($scope.form.$invalid) {
   angular.forEach($scope.form.$error, function (field) {
     angular.forEach(field, function(errorField){
       errorField.$setTouched();
     })
   });

   Flash.create('danger', 'Por favor, preencha os campos em vermelho!', 'large-text');
   return false;
 }

 $http.post('https://www.iptufacil.com.br/ws/goey/rest/public/cadastroUsuario',
  ({'dados':$scope.cadUsuario, auth: "3f018bfb43591ccb2ef46f10de832160"})).then(function(response){
    Flash.create('warning',response.data.mensagem, 'large-text');
 });

}

$scope.clearForm = function(){

 $scope.form.$setPristine();
 $('#cpf').val('');

}

$("#showModal").click(function() {
 $("#cadUsuario").modal("show");
 $('modal').modal('hide');
 $scope.clearForm();
});


}]);
